---
title: "Long Term S&P 500 Models"
author: "Micah Williams"
date: "3/18/2021"
output: html_document
---

```{r setup, include=FALSE}
# set options
knitr::opts_chunk$set(echo = F,
                      fig.width = 7,
                      fig.height = 5,
                      fig.align = 'center')

# import required packages
library(tidyverse)
library(RColorBrewer)
library(lubridate)

theme_set(theme_minimal())

# import S&P500 data from Quandl package
sp <- Quandl::Quandl("MULTPL/SP500_INFLADJ_MONTH", api_key="ouXsKHk7DUeaYiFanm9b") %>%
  janitor::clean_names()

# import recession dates
recessions <- read_csv('data/nber_recessions.csv') %>% 
  filter(end > min(sp$date))
```

```{r structure, fig.width= 7.5}
head(sp)
```


This dataset contains monthly inflation-adjusted (in January 2021 dollars) average closing prices of the S&P 500 index. There are **1,815** rows in the dataset, and each row contains a date, the first day of a month, and a value, the average closing price of the index during the month ending on the given day. The dates range from Jan. 1, 1871 to March 1, 2021. The average closing prices range from \$70.77 to \$3901.82.

Here's what the data looks like with the y-axis on a log scale, with recessions marked with shaded areas:

```{r structure, fig.width= 7.5}
sp %>%
  ggplot() +
  geom_line(aes(date, value),
            color = 'navy',
            size = 1.2) +
  
  geom_rect(aes(xmin = start, xmax = end,
                ymin = 70.77, ymax = 3901.82),
            fill = 'gray',
            alpha = 0.5,
            data = recessions) +
  
  labs(title = 'Average S&P500 Closing Price by Month, from Jan. 1, 1871 to March 1, 2021',
       subtitle = 'Shaded areas indicate recessions',
       caption = 'Price data from Quandl, Recession dates from NBER.\nValues are inflation adjusted to Jan. 2021') +
  
  scale_y_log10(name = 'Average Closing Price (log scale)') +
  scale_x_date(breaks = as.Date(paste0(seq(1875,2025,25),'-01-01')),
               date_labels = '%Y',
               name = '')
```

## Time in the Market

```{r}
# all in on Jan 1 1871
10000 * sp[sp$date == as.Date('2021-03-01'),'value'] / sp[sp$date == as.Date('1871-01-01'),'value']

# wait for the crash
10000 * sp[sp$date == as.Date('2021-03-01'),'value'] / sp[sp$value == min(sp$value),'value']
```

Now, let's pretend you have \$10,000 to invest. If you invested it all on Jan. 1 1871, you'd have around \$419,000 today. A handsome return! It's a shame you're too dead to enjoy it. 

If you had waited for the market to crash, as it did a few years later, and bought in when the S&P was at its lowest (down around 25% from Jan. 1871), you'd have more than \$551,000. You'd be the richest dead guy in the cemetary!

Of course, you probably want to enjoy your wealth while you're still alive, and 150 years is a long time to wait. If you only had forty years to invest, what month would've been the best to start?

```{r}

```

